<!DOCTYPE html>
<html class="dark" lang="pt">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Darkwave OS - Color Change Fixed</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet"/>

<script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "background-dark": "#050005",
            "card-dark": "#0a000a",
            // AQUI EST√Å O SEGREDO: Cores mapeadas para vari√°veis CSS
            "neon-main": "var(--neon-primary)",
            "neon-sec": "var(--neon-secondary)",
          },
          fontFamily: {
            "display": ["Spline Sans", "sans-serif"]
          },
          zIndex: { '60': '60', '70': '70', '80': '80' }
        },
      },
    }
</script>

<style>
    /* Defini√ß√£o das Cores Padr√£o (Roxo) */
    :root {
        --neon-primary: #9d00ff;
        --neon-secondary: #ff004c;
    }
    
    /* Temas - Alteram as vari√°veis globais */
    body.theme-red { --neon-primary: #ff0000; --neon-secondary: #8a0000; }
    body.theme-green { --neon-primary: #00ff00; --neon-secondary: #004400; }
    body.theme-blue { --neon-primary: #0088ff; --neon-secondary: #000088; }
    body.theme-yellow { --neon-primary: #ffee00; --neon-secondary: #ffaa00; }
    
    body.font-bold-mode * { font-weight: 700 !important; }

    body {
        background-color: #000;
        overflow-x: hidden; touch-action: pan-y; user-select: none;
        -webkit-tap-highlight-color: transparent;
        transition: color 0.5s ease, border-color 0.5s ease; /* Transi√ß√£o suave de cor */
    }

    /* Sliders do Equalizador com a cor do tema */
    input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
        background: var(--neon-primary); margin-top: -6px; box-shadow: 0 0 10px var(--neon-primary);
        transition: background 0.3s;
    }
    input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border-radius: 2px; }

    /* Anima√ß√µes */
    #side-menu { transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); will-change: transform; }
    #side-menu.open { transform: translateX(0); box-shadow: 5px 0 30px rgba(0,0,0,0.8); }
    
    @keyframes equalizer-bounce { 0% { height: 10%; } 50% { height: 100%; } 100% { height: 10%; } }
    .eq-bar { width: 8px; background: var(--neon-primary); animation: equalizer-bounce 0.5s infinite; transition: background 0.3s; }
    .eq-bar:nth-child(1) { animation-duration: 0.4s; }
    .eq-bar:nth-child(odd) { animation-duration: 0.6s; }

    /* Modals */
    .modal-overlay { opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(5px); }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }
    .modal-content { transform: scale(0.9); transition: transform 0.3s; }
    .modal-overlay.active .modal-content { transform: scale(1); }

    /* Efeitos de Texto e Brilho Din√¢micos */
    .text-glow { text-shadow: 0 0 10px var(--neon-primary); }
    .border-glow { box-shadow: 0 0 10px var(--neon-primary), inset 0 0 5px var(--neon-primary); }
    
    /* Panic Mode */
    @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 100% { transform: translate(-1px, -2px) rotate(-1deg); } }
    .panic-active { animation: shake 0.1s infinite; filter: invert(1) grayscale(100%); border: 2px solid red; }
</style>
<script src="https://www.youtube.com/iframe_api"></script>
</head>

<body class="bg-background-dark font-display text-gray-200 h-screen flex flex-col overflow-hidden">

    <div id="menu-overlay" class="fixed inset-0 z-60 bg-black/80 hidden" onclick="toggleMenu()"></div>
    
    <aside id="side-menu" class="fixed top-0 left-0 z-70 h-full w-80 bg-card-dark border-r border-white/10 flex flex-col">
        <div class="p-6 border-b border-white/10 flex flex-col items-center bg-black/50 gap-3">
            <div id="profile-pic-display" class="w-20 h-20 rounded-full border-2 border-neon-main bg-cover bg-center transition-all duration-300" style="background-image: url('https://api.dicebear.com/7.x/bottts/svg?seed=Goth'); box-shadow: 0 0 15px var(--neon-primary);"></div>
            <h2 class="text-xl font-bold tracking-[0.2em] text-white uppercase text-glow">User_01</h2>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <button onclick="openModal('modal-profile')" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 hover:text-neon-main transition-all border border-transparent hover:border-neon-main">
                <span class="material-symbols-rounded text-2xl">face</span> 
                <span class="font-medium tracking-wide">Perfil / Avatar</span>
            </button>
            <button onclick="openModal('modal-eq')" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 hover:text-neon-main transition-all border border-transparent hover:border-neon-main">
                <span class="material-symbols-rounded text-2xl">equalizer</span> 
                <span class="font-medium tracking-wide">Equalizador</span>
            </button>
            <button onclick="openModal('modal-settings')" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 hover:text-neon-main transition-all border border-transparent hover:border-neon-main">
                <span class="material-symbols-rounded text-2xl">settings</span> 
                <span class="font-medium tracking-wide">Configura√ß√µes</span>
            </button>
            <div class="h-px bg-white/10 my-4"></div>
            <button onclick="systemLogout()" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-900/20 hover:text-red-500 transition-all border border-transparent hover:border-red-900/50">
                <span class="material-symbols-rounded text-2xl">power_settings_new</span> 
                <span class="font-medium tracking-wide">Sair / Desligar</span>
            </button>
        </nav>
    </aside>

    <div id="modal-profile" class="modal-overlay fixed inset-0 z-80 flex items-center justify-center bg-black/90">
        <div class="modal-content bg-card-dark w-11/12 max-w-md p-6 rounded-2xl border border-white/10 shadow-2xl">
            <h3 class="text-xl font-bold text-center mb-4 text-neon-main">SELECIONE SEU AVATAR</h3>
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div onclick="setAvatar('üíÄ')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üíÄ</div>
                <div onclick="setAvatar('üßõ')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üßõ</div>
                <div onclick="setAvatar('ü¶á')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">ü¶á</div>
                <div onclick="setAvatar('üï∑Ô∏è')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üï∑Ô∏è</div>
                <div onclick="setAvatar('üåë')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üåë</div>
                <div onclick="setAvatar('üëÅÔ∏è')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üëÅÔ∏è</div>
                <div onclick="setAvatar('ü•Ä')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">ü•Ä</div>
                <div onclick="setAvatar('üëΩ')" class="aspect-square rounded-lg bg-white/5 flex items-center justify-center text-3xl cursor-pointer hover:bg-neon-main hover:text-white transition">üëΩ</div>
            </div>
            <button onclick="closeModal('modal-profile')" class="w-full py-3 bg-white/10 rounded-xl font-bold hover:bg-white/20">FECHAR</button>
        </div>
    </div>

    <div id="modal-eq" class="modal-overlay fixed inset-0 z-80 flex items-center justify-center bg-black/90">
        <div class="modal-content bg-card-dark w-11/12 max-w-md p-6 rounded-2xl border border-neon-main shadow-[0_0_20px_var(--neon-primary)]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-neon-main tracking-widest">EQUALIZADOR</h3>
                <div class="flex gap-1 h-6 items-end">
                    <div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div>
                </div>
            </div>
            <div class="space-y-4 mb-6">
                <div class="flex items-center gap-4"><span class="text-xs w-8 text-gray-500">BASS</span><input type="range" min="0" max="100" value="80"></div>
                <div class="flex items-center gap-4"><span class="text-xs w-8 text-gray-500">MID</span><input type="range" min="0" max="100" value="50"></div>
                <div class="flex items-center gap-4"><span class="text-xs w-8 text-gray-500">TREB</span><input type="range" min="0" max="100" value="60"></div>
            </div>
            <div class="grid grid-cols-3 gap-2 mb-4">
                <button class="bg-white/5 py-2 text-xs rounded hover:bg-neon-main hover:text-white transition">BASS BOOST</button>
                <button class="bg-white/5 py-2 text-xs rounded hover:bg-neon-main hover:text-white transition">VOCAL</button>
                <button class="bg-white/5 py-2 text-xs rounded hover:bg-neon-main hover:text-white transition">DARKWAVE</button>
            </div>
            <button onclick="closeModal('modal-eq')" class="w-full py-3 bg-neon-main rounded-xl font-bold text-white shadow-lg shadow-neon-main/50 transition-colors">APLICAR</button>
        </div>
    </div>

    <div id="modal-settings" class="modal-overlay fixed inset-0 z-80 flex items-center justify-center bg-black/90">
        <div class="modal-content bg-card-dark w-11/12 max-w-md p-6 rounded-2xl border border-white/10">
            <h3 class="text-xl font-bold text-center mb-6 text-neon-main">CONFIGURA√á√ïES</h3>
            <div class="space-y-6">
                <div>
                    <p class="text-xs text-gray-500 mb-2 uppercase tracking-widest">Tema / Cor do Sistema</p>
                    <div class="flex gap-3 justify-center">
                        <button onclick="setTheme('purple')" class="w-10 h-10 rounded-full bg-[#9d00ff] border-2 border-white/20 hover:scale-110 transition shadow-[0_0_10px_#9d00ff]"></button>
                        <button onclick="setTheme('red')" class="w-10 h-10 rounded-full bg-[#ff0000] border-2 border-white/20 hover:scale-110 transition shadow-[0_0_10px_#ff0000]"></button>
                        <button onclick="setTheme('green')" class="w-10 h-10 rounded-full bg-[#00ff00] border-2 border-white/20 hover:scale-110 transition shadow-[0_0_10px_#00ff00]"></button>
                        <button onclick="setTheme('blue')" class="w-10 h-10 rounded-full bg-[#0088ff] border-2 border-white/20 hover:scale-110 transition shadow-[0_0_10px_#0088ff]"></button>
                        <button onclick="setTheme('yellow')" class="w-10 h-10 rounded-full bg-[#ffee00] border-2 border-white/20 hover:scale-110 transition shadow-[0_0_10px_#ffee00]"></button>
                    </div>
                </div>
                <div>
                    <p class="text-xs text-gray-500 mb-2 uppercase tracking-widest">Idioma</p>
                    <div class="flex bg-white/5 rounded-lg p-1">
                        <button onclick="setLang('pt')" class="flex-1 py-2 rounded text-sm bg-white/10 text-white font-bold">Portugu√™s</button>
                        <button onclick="setLang('en')" class="flex-1 py-2 rounded text-sm text-gray-500 hover:text-white">English</button>
                    </div>
                </div>
                <div class="flex items-center justify-between bg-white/5 p-3 rounded-lg">
                    <span class="text-sm font-bold">Texto em Negrito</span>
                    <button onclick="toggleBold()" class="w-12 h-6 bg-gray-600 rounded-full relative transition-colors duration-300" id="bold-toggle">
                        <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform duration-300" id="bold-knob"></div>
                    </button>
                </div>
            </div>
            <button onclick="closeModal('modal-settings')" class="w-full py-3 mt-8 bg-white/10 rounded-xl font-bold hover:bg-white/20">SALVAR</button>
        </div>
    </div>

    <header class="sticky top-0 z-30 bg-black/90 backdrop-blur-xl border-b border-white/10 shrink-0">
        <div class="flex items-center justify-between p-4">
            <button onclick="toggleMenu()" class="p-2 text-white hover:bg-white/10 rounded-full transition-all">
                <span class="material-symbols-rounded text-3xl">menu</span>
            </button>
            <h1 class="text-xl font-bold tracking-[0.3em] uppercase text-transparent bg-clip-text animate-pulse" 
                style="background-image: linear-gradient(to right, var(--neon-primary), #fff, var(--neon-primary));">
                DARKWAVE
            </h1>
            <button onclick="triggerPanic()" class="p-2 border border-red-900 bg-red-900/20 rounded-full animate-pulse">
                <span class="material-symbols-rounded text-red-500">warning</span>
            </button>
        </div>
        <nav class="flex text-xs font-bold tracking-widest uppercase border-b border-white/5">
            <button onclick="switchTab('tracks')" id="tab-tracks" class="flex-1 py-4 border-b-2 border-neon-main text-neon-main bg-white/5 transition-colors">Faixas</button>
            <button onclick="switchTab('playlist')" id="tab-playlist" class="flex-1 py-4 border-b-2 border-transparent text-gray-500 transition-colors">Playlist</button>
            <button onclick="switchTab('artists')" id="tab-artists" class="flex-1 py-4 border-b-2 border-transparent text-gray-500 transition-colors">Artistas</button>
        </nav>
    </header>

    <main class="flex-1 overflow-y-auto pb-48 relative">
        <div id="view-tracks" class="p-3 space-y-4">
            <div class="grid grid-cols-4 gap-2 bg-black/40 p-2 rounded-2xl border border-white/5 sticky top-2 z-20 backdrop-blur-md">
                <button onclick="playAll()" class="col-span-1 bg-neon-main/20 text-neon-main rounded-xl py-3 flex flex-col items-center hover:bg-neon-main hover:text-white transition-all"><span class="material-symbols-rounded">playlist_play</span><span class="text-[0.6rem] font-bold mt-1">ALL</span></button>
                <button onclick="stopSong()" class="col-span-1 bg-red-900/20 text-red-300 rounded-xl py-3 flex flex-col items-center hover:bg-red-600 hover:text-white transition-all"><span class="material-symbols-rounded">stop_circle</span><span class="text-[0.6rem] font-bold mt-1">STOP</span></button>
                <button onclick="prevSong()" class="bg-white/5 text-gray-400 rounded-xl py-3 flex flex-col items-center hover:text-white"><span class="material-symbols-rounded">skip_previous</span></button>
                <button onclick="nextSong()" class="bg-white/5 text-gray-400 rounded-xl py-3 flex flex-col items-center hover:text-white"><span class="material-symbols-rounded">skip_next</span></button>
            </div>
            <div id="list-tracks" class="flex flex-col gap-2 pb-4"></div>
        </div>

        <div id="view-playlist" class="hidden p-3 space-y-3">
            <button onclick="playMyPlaylist()" class="w-full py-4 border border-neon-main/30 rounded-xl font-bold tracking-widest flex items-center justify-center gap-2 text-white transition-all hover:bg-neon-main" 
                    style="background: linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.8));">
                <span class="material-symbols-rounded">play_circle</span> TOCAR MINHA LISTA
            </button>
            <div id="list-playlist" class="flex flex-col gap-2 pb-4">
                <div class="text-center py-10 text-gray-600 uppercase text-xs tracking-widest">Lista Vazia</div>
            </div>
        </div>

        <div id="view-artists" class="hidden p-3 pb-4">
            <div id="grid-artists" class="grid grid-cols-2 gap-3"></div>
        </div>
    </main>

    <footer id="player-footer" class="fixed bottom-0 w-full z-50 bg-[#050005]/95 backdrop-blur-xl border-t border-white/10 shadow-[0_-5px_30px_#000]">
        <div class="h-1.5 w-full bg-gray-900 overflow-hidden">
            <div id="progress-fill" class="h-full" style="width: 0%; background: linear-gradient(to right, var(--neon-primary), #fff, var(--neon-primary));"></div>
        </div>
        <div class="flex items-center gap-3 p-3">
            <div class="relative h-14 w-14 shrink-0 rounded-lg overflow-hidden bg-gray-800 border border-white/10">
                <div id="player-art" class="absolute inset-0 bg-cover bg-center" style="background-image: url('');"></div>
                <div id="yt-player" class="absolute inset-0 opacity-0 pointer-events-none"></div>
            </div>
            <div class="flex-1 min-w-0 flex flex-col justify-center">
                <p id="track-title" class="truncate text-sm font-bold text-white">Darkwave OS</p>
                <p id="track-artist" class="truncate text-xs text-neon-main font-medium">Sistema Pronto</p>
            </div>
            <button onclick="togglePlay()" id="btn-play" class="flex h-12 w-12 items-center justify-center rounded-full bg-white text-black hover:bg-neon-main hover:text-white transition shadow-[0_0_15px_rgba(255,255,255,0.2)]">
                <span class="material-symbols-rounded text-3xl">play_arrow</span>
            </button>
        </div>
    </footer>

    <div id="shutdown-screen" class="fixed inset-0 z-[100] bg-black hidden flex items-center justify-center">
        <div class="text-center">
            <span class="material-symbols-rounded text-6xl text-gray-500 mb-4 animate-pulse">power_off</span>
            <p class="text-gray-500 tracking-[0.5em] text-xs">SYSTEM OFFLINE</p>
        </div>
    </div>

<script>
    const allSongs = [
        { id: "-HeCgOiirV4", artist: "Lebanon Hanover", title: "Gallowdance" },
        { id: "tBpQ1f77PDA", artist: "She Past Away", title: "Kasvetli Kutlama" },
        { id: "h4Jnv-pb6sk", artist: "Boy Harsher", title: "Pain" },
        { id: "A_ZJnKoMoBA", artist: "Molchat Doma", title: "Sudno" },
        { id: "9CvpeDHgCpo", artist: "The Cure", title: "A Forest" },
        { id: "LHUz8vA_wCM", artist: "Joy Division", title: "Disorder" },
        { id: "bIGoN8_vv_Y", artist: "Bauhaus", title: "Bela Lugosi's Dead" },
        { id: "npQwX2X3WBE", artist: "Siouxsie and the Banshees", title: "Spellbound" },
        { id: "qLQ0PZ-Zwc8", artist: "Sisters of Mercy", title: "Lucretia My Reflection" },
        { id: "bjxfcGJM3V4", artist: "Clan of Xymox", title: "Jasmine and Rose" },
        { id: "DOzdBjtA9H0", artist: "London After Midnight", title: "Sacrifice" },
        { id: "qFtiH1bZuJ0", artist: "Drab Majesty", title: "Ellipsis" },
        { id: "FaHMRB30HmA", artist: "Twin Tribes", title: "Fantasmas" },
        { id: "VdAlPCrndT8", artist: "Selofan", title: "Give Me A Reason" },
        { id: "gebchYvcp2s", artist: "K√¶lan Mikla", title: "Draumad√≠s" },
        { id: "77GxLUUEcHo", artist: "TR/ST", title: "Sulk" },
        { id: "bYM8iPn47yE", artist: "Mareux", title: "The Perfect Girl" },
        { id: "bpxKOOUhLs8", artist: "Crystal Castles", title: "Transgender" },
        { id: "y0AaKrZLFQo", artist: "Pastel Ghost", title: "Dark Beach" },
        { id: "LVQi3iyx_Hc", artist: "Sidewalks and Skeletons", title: "Goth" },
        { id: "ElcwzDwdYkA", artist: "Mr.Kitty", title: "After Dark" },
        { id: "F3VwhAe7Ks0", artist: "Depeche Mode", title: "Enjoy The Silence" },
        { id: "mwooX2qXrwE", artist: "The KVB", title: "Always Then" },
        { id: "lAt6qFZby5w", artist: "Cold Cave", title: "Confetti" },
        { id: "Wj1r0bU3pkg", artist: "Soft Kill", title: "Whirl" },
        { id: "5zS9CbU1gxY", artist: "Choir Boy", title: "Complainer" },
        { id: "pO4lvJUwrwk", artist: "Black Marble", title: "A Great Design" },
        { id: "X8wAX8uZHi8", artist: "Human Tetris", title: "Things I Don't Need" },
        { id: "4AcNJQYb0Rw", artist: "Motorama", title: "Alps" },
        { id: "6170iawsQHE", artist: "Soviet Soviet", title: "Ecstasy" }
    ];

    let myPlaylist = [];
    let player;
    let currentContext = 'all';
    let currentIndex = 0;
    let isPlaying = false;
    let activeList = allSongs;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            height: '100%', width: '100%', videoId: allSongs[0].id,
            playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 },
            events: { 'onStateChange': onPlayerStateChange, 'onReady': () => updatePlayerUI(allSongs[0]) }
        });
    }

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            isPlaying = true;
            document.querySelector('#btn-play span').innerText = 'pause';
            startProgressLoop();
        } else {
            isPlaying = false;
            document.querySelector('#btn-play span').innerText = 'play_arrow';
            if (event.data == YT.PlayerState.ENDED) nextSong();
        }
    }

    function loadSong(index, context = 'all', specificList = null) {
        currentContext = context;
        if(specificList) activeList = specificList;
        else if(context === 'all') activeList = allSongs;
        else if(context === 'playlist') activeList = myPlaylist;

        if (activeList.length === 0) return;
        if (index >= activeList.length) index = 0;
        if (index < 0) index = activeList.length - 1;
        
        currentIndex = index;
        const song = activeList[currentIndex];

        if(player && player.loadVideoById) player.loadVideoById(song.id);
        updatePlayerUI(song);
    }

    function togglePlay() { isPlaying ? player.pauseVideo() : player.playVideo(); }
    function stopSong() { if(player) player.stopVideo(); isPlaying = false; document.getElementById('progress-fill').style.width = '0%'; document.querySelector('#btn-play span').innerText = 'play_arrow'; }
    function nextSong() { loadSong(currentIndex + 1, currentContext); }
    function prevSong() { loadSong(currentIndex - 1, currentContext); }
    function playAll() { loadSong(0, 'all'); alert('Reproduzindo Todas as Faixas'); }
    
    function playMyPlaylist() {
        if(myPlaylist.length === 0) return alert('Playlist vazia!');
        loadSong(0, 'playlist');
        alert('Reproduzindo Sua Playlist');
    }

    function playArtist(artistName) {
        const artistSongs = allSongs.filter(s => s.artist === artistName);
        if(artistSongs.length > 0) {
            renderFilteredTracks(artistSongs);
            switchTab('tracks');
            loadSong(0, 'artist', artistSongs);
            alert(`Tocando cole√ß√£o de: ${artistName}`);
        }
    }

    function updatePlayerUI(song) {
        document.getElementById('track-title').innerText = song.title;
        document.getElementById('track-artist').innerText = song.artist;
        document.getElementById('player-art').style.backgroundImage = `url('https://img.youtube.com/vi/${song.id}/mqdefault.jpg')`;
    }

    function startProgressLoop() {
        if (!player || !isPlaying) return;
        const d = player.getDuration();
        const c = player.getCurrentTime();
        if (d > 0) document.getElementById('progress-fill').style.width = (c / d) * 100 + '%';
        requestAnimationFrame(startProgressLoop);
    }

    function renderFilteredTracks(list) {
        const listTracks = document.getElementById('list-tracks');
        listTracks.innerHTML = `<button onclick="renderLists()" class="w-full py-2 bg-gray-800 text-xs mb-2 text-gray-400 hover:text-white">VOLTAR PARA TODAS</button>` + 
        list.map((song, i) => createTrackItem(song, i, 'artist')).join('');
    }

    function renderLists() {
        document.getElementById('list-tracks').innerHTML = allSongs.map((song, i) => createTrackItem(song, i, 'all')).join('');
        const playlistContainer = document.getElementById('list-playlist');
        if (myPlaylist.length > 0) {
            playlistContainer.innerHTML = myPlaylist.map((song, i) => createTrackItem(song, i, 'playlist')).join('');
        } else {
            playlistContainer.innerHTML = `<div class="text-center py-10 text-gray-600 uppercase text-xs tracking-widest">Lista Vazia</div>`;
        }
        const uniqueArtists = [...new Set(allSongs.map(s => s.artist))];
        document.getElementById('grid-artists').innerHTML = uniqueArtists.map(artist => {
            const song = allSongs.find(s => s.artist === artist);
            return `
                <div onclick="playArtist('${artist}')" class="relative aspect-square rounded-xl overflow-hidden border border-white/5 group cursor-pointer hover:border-neon-main transition-all bg-gray-900">
                    <img src="https://img.youtube.com/vi/${song.id}/hqdefault.jpg" class="w-full h-full object-cover grayscale opacity-70 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-500">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent flex items-end p-2">
                        <span class="text-[10px] font-bold text-white truncate w-full uppercase tracking-wider">${artist}</span>
                    </div>
                </div>
            `;
        }).join('');
    }

    function createTrackItem(song, index, context) {
        const isPlaylist = context === 'playlist';
        const btnIcon = isPlaylist ? 'remove_circle' : 'add_circle';
        const btnColor = isPlaylist ? 'text-red-500 hover:text-white' : 'text-gray-500 hover:text-neon-main';
        const btnAction = isPlaylist ? `removeFromPlaylist('${song.id}', event)` : `addToPlaylist('${song.id}', event)`;

        return `
            <div onclick="loadSong(${index}, '${context}')" class="flex items-center gap-3 p-2 rounded-xl bg-white/5 border border-transparent hover:border-neon-main/30 hover:bg-white/10 cursor-pointer group transition-all">
                <img src="https://img.youtube.com/vi/${song.id}/default.jpg" class="h-10 w-10 rounded-lg object-cover opacity-80">
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold text-gray-200 truncate group-hover:text-neon-main transition-colors">${song.title}</p>
                    <p class="text-[10px] text-gray-500 uppercase truncate">${song.artist}</p>
                </div>
                <button onclick="${btnAction}" class="p-3 ${btnColor} transition-colors"><span class="material-symbols-rounded text-xl">${btnIcon}</span></button>
            </div>
        `;
    }

    function addToPlaylist(id, e) {
        e.stopPropagation();
        const song = allSongs.find(s => s.id === id);
        if (!myPlaylist.some(s => s.id === id)) {
            myPlaylist.push(song);
            renderLists();
            const btn = e.currentTarget;
            btn.innerHTML = '<span class="material-symbols-rounded text-xl text-green-500">check</span>';
        }
    }

    function removeFromPlaylist(id, e) {
        e.stopPropagation();
        myPlaylist = myPlaylist.filter(s => s.id !== id);
        renderLists();
    }

    function toggleMenu() {
        const menu = document.getElementById('side-menu');
        const overlay = document.getElementById('menu-overlay');
        const isOpen = menu.classList.contains('open');
        isOpen ? menu.classList.remove('open') : menu.classList.add('open');
        isOpen ? overlay.classList.add('hidden') : overlay.classList.remove('hidden');
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); toggleMenu(); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    function setAvatar(emoji) {
        if(emoji.length < 5) {
             const div = document.getElementById('profile-pic-display');
             div.style.backgroundImage = 'none';
             div.innerText = emoji;
             div.className = "w-20 h-20 rounded-full border-2 border-neon-main bg-black flex items-center justify-center text-4xl shadow-[0_0_15px_var(--neon-primary)]";
        }
        closeModal('modal-profile');
    }

    // --- AQUI EST√Å A CORRE√á√ÉO PRINCIPAL DO TEMA ---
    function setTheme(color) {
        // Remove classes anteriores
        document.body.classList.remove('theme-red', 'theme-green', 'theme-blue', 'theme-yellow');
        
        // Adiciona a nova classe se n√£o for o roxo padr√£o
        if(color !== 'purple') {
            document.body.classList.add(`theme-${color}`);
        }
    }

    function setLang(lang) { alert(lang === 'pt' ? 'Idioma: Portugu√™s' : 'Language: English'); }
    
    function toggleBold() {
        document.body.classList.toggle('font-bold-mode');
        const knob = document.getElementById('bold-knob');
        const toggle = document.getElementById('bold-toggle');
        if(document.body.classList.contains('font-bold-mode')) {
            knob.style.transform = 'translateX(24px)';
            toggle.style.backgroundColor = 'var(--neon-primary)';
        } else {
            knob.style.transform = 'translateX(0)';
            toggle.style.backgroundColor = '#4b5563';
        }
    }

    function systemLogout() {
        const screen = document.getElementById('shutdown-screen');
        screen.classList.remove('hidden');
        if(player) player.stopVideo();
        setTimeout(() => window.location.reload(), 2000);
    }

    function switchTab(tab) {
        ['tracks', 'playlist', 'artists'].forEach(t => {
            const btn = document.getElementById(`tab-${t}`);
            btn.classList.remove('border-neon-main', 'text-neon-main', 'bg-white/5');
            btn.classList.add('border-transparent', 'text-gray-500');
            document.getElementById(`view-${t}`).classList.add('hidden');
        });
        const activeBtn = document.getElementById(`tab-${tab}`);
        activeBtn.classList.remove('border-transparent', 'text-gray-500');
        activeBtn.classList.add('border-neon-main', 'text-neon-main', 'bg-white/5');
        document.getElementById(`view-${tab}`).classList.remove('hidden');
    }

    function triggerPanic() {
        document.body.classList.toggle('panic-active');
        if(document.body.classList.contains('panic-active') && isPlaying) player.pauseVideo();
    }

    renderLists();
</script>
</body>
</html>
